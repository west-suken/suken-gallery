---
title: 魔方陣
date: 2019-09-11 23:19:32
tags:
cover_index: https://7u0ooq.bn.files.1drv.com/y4mMaKkUCrXlGNo-UWOQOCfgnIxAZhG0G6oOeuR22-KI8ppvhzG5WzfNULEDNjsP2BMy_kQBfpQYhlHUMGMKbYQhKelIHoEBW2AOjfYcoAhcUyDRjXRjcS4gRH6YzGRY2_Y9A5VLHmSCJ6PUiiLq2PprwtC9CrYtRYPWJ6kO2GBX1y1UMTR_3FSg49bbVgP60XQ5yOFNfvgGtUlq7x6UpXqHw?width=660&height=254&cropmode=none
cover_detail: https://7u0ooq.bn.files.1drv.com/y4mMaKkUCrXlGNo-UWOQOCfgnIxAZhG0G6oOeuR22-KI8ppvhzG5WzfNULEDNjsP2BMy_kQBfpQYhlHUMGMKbYQhKelIHoEBW2AOjfYcoAhcUyDRjXRjcS4gRH6YzGRY2_Y9A5VLHmSCJ6PUiiLq2PprwtC9CrYtRYPWJ6kO2GBX1y1UMTR_3FSg49bbVgP60XQ5yOFNfvgGtUlq7x6UpXqHw?width=1300&height=500&cropmode=none
---

by φ111

さあて！次は魔方陣についてだ！  
君は「魔方陣」が何か知っているかな？  
そう。下にあるような図のことだね。  
![img1](https://pp0foq.bn.files.1drv.com/y4mLYjBBl9py3FQO0cajszGZLO0jCMBvyDEGeEhdYsw3v5A4zhkwoUICkxz6jnnp1FY49P-GOvKQCta2Gj4ppkEUVdxFswtlfphpo75paz98aIW0RtsbNdO3mDw1VASdOTdCCl8H158AZ8mFe-B8Yrk_cQGbQCWeY4cdtJt4arRx3uQsmrZ_gFqI5hQyVWZq2aJT8goX4TnvJfwBgrWa-IOJA?width=256&height=243&cropmode=none)  
ではまず、魔方陣とは何かについて見ていこう！  
魔方陣とは、 君もご存じの通り、 正方形の方陣の中に数字を配置し、<u>**縦と横のすべての列や行及び対角線上の数の和が同じ数値になる**</u>というもののことだ。その時、同じになる和のことを「魔法和」と呼ぶんだ。$4\times4$の魔方陣ならば、四隅と中央の$2\times2$の和も魔法和となる。）  
ここで、上の魔方陣を見てみよう。この魔方陣は、 アルブレヒト・デューラーが1514年に制作した銅版画『メランコリア』の中に描いたものだ。実はアルブレヒト・デューラーはドイツのルネサンス期に活躍した画家でもあり版画家でもあり尚且つ数学者でもあったんだ。そしてこの魔方陣は、ヨーロッパで絵画に描かれた最初の魔方陣。また、デューラーはこの銅版画の制作年である1514という数字を最下段の中央に入れた。さらにこの魔方陣は、普通の魔方陣とは違い、以下の4項目の4個の数の和も魔法和となる、素晴らしいものなんだ。 
* 四隅の4個の数
* 中心の十字で4つに分けたときのそれぞれ（右上、右下、左上、左下）の4個の数
* 中心の4個の数
* 汎対角線<sup><a href="#1">\*1</a></sup>のうち上下左右に数字が2つずつ分かれるときの4個の数  

![img2](https://pp0moq.bn.files.1drv.com/y4m1O_XuIvKHRqEm9M58NL5MSbE2mt08LPRJZXD0WpX2p7G3U5jRc-imAZY8xk3sqlrcauHCrQe3ZG6ecW_f2TVqR-kcyD8BYxRnCwBptUlt9EpYmaeAd73S_dVUHR3m2NDqdZCVtAm978RzlZSDRhXVx7WYpbCw5JaEtZWc93mN6f8rLarybOTlsAElKJRPdx3SgqY_6HPihJ8GrbCKHNr9g?width=660&height=132&cropmode=none)  
試しに計算してみてほしい。きっと君はこの不思議な数の集まりに感動するだろう。

## 完全方陣
さて、「完全方陣」というものを聞いたことがあるかな？ 普通の魔方陣は、縦と横のすべての列や行及び対角線上の数の和が同じ数値になると先程書いたね。ただ、完全方陣はそれに加えて、汎対角線<sup><a href="#1">\*1</a></sup>の和も魔法和と等しくなるんだ。また、完全方陣によっては、以下の項目においても魔法和が成り立つ事がある。
* 任意の$2\times2$の数値の和
* 任意の$3\times3$の正方形の四隅の和
* 2つの数が隣り合う上段と下段または右列と左列の4個の数の和
* ペントミノ<sup><a href="#2">\*2</a></sup>(T字)の5個の数の和  

(例外)任意の斜めの3つの数字の両端の2個の数の和は17になる  
ここで、先程のデューラーの魔方陣が完全方陣なのでは？ と疑問に思う人がいるかもしれないが、あの魔方陣はすべての汎対角線において魔法和が成り立つわけではないため、完全方陣ではないだろう。  
<span id="1" style="font-size:x-small">\*1 **汎対角線**: 斜めにたどっていき、左右または上下の端に来たら反対側に続くラインのこと。これは魔方陣の右端と左端または上端と下端がつながっていると考えたときの斜めの線となる。  
<span id="2" style="font-size:x-small">\*2 **ペントミノ**: 5つの正方形を辺に沿ってつなげた形の総称のこと。回転移動、対称移動によって同じになるものを同一と考えると12種類ある。

## 最初の魔方陣
おっと、魔方陣の歴史について書くのを忘れていたよ。世界最古の魔方陣は、4000年前の中国で、後に夏(か)の初代皇帝となる禹(う)という王が、亀の甲から発見したといわれているんだ。禹王は、治めていた国に流れていた洛水という川が9年連続で氾濫をしたため、治水工事を行った。そのとき、黄河の支流であるその伝説の川、洛水から1匹の神聖な亀が現れた。そしてなんとその亀の甲には9つの数字が縦横3つずつ並んで描かれていたのであった。それが最初の魔方陣。その時人々は、この数字は天が授けてくれたものだとして『洛書』と呼び、大切にした。
そんな4000年前に現れた魔方陣、作ってみたくないかい？  
⑴ 1 から9 までの数字を書き並べる  
⑵ 対角にある数字をそれぞれ入れ替える  
⑶ 正方形の角の数字を押し入れてひし形にする  
![img3](https://pp0goq.bn.files.1drv.com/y4maj2hGwFXk68Xsup3T2KgGh9hBwG2qvzANKjGXvi3hcR7yTBEXhD_j76MludMrKB9LiyKwsNzjS9BvjqS-Ixh8kBvRe-dwHEsXFffeaM3DxFCQa8MbE0aR0A6SHmGq3zbZvaS9pZCXURlpdSsDoUiAeREFZfmvWBep4AsueNNpypbRYYBM5LVpZpTcHMIL7Sl4KLf8aOs3Eau-8Dw_CEChg?width=660&height=182&cropmode=none)  
これで完成だ！

## 騎士の旅
下の、魔法和が260になる魔方陣を見てみよう。この魔方陣の特徴が君には分かるかな？ ヒントはすでに題名に書いてあるが、もう一つあげよう。数字を1から順に追っていくんだ。そう、次の数字に行くときの動きが、2歩前進歩前進1歩横進というチェスの騎士の動き(桂馬飛び桂馬飛び)と同じ動き方なんだ。  
![img4](https://po0noq.bn.files.1drv.com/y4mqh20oOsQjcehqj6q9ezLBtPUNFu3fYhak7-lgSUfKMA49-8YHrbi3OkqiLKEYiQCpV3xCdZYG11ALxGyZ-0DaETruCa9HjCRrzcWbVkKBNxGtkZ3wufhygciRpIeJzTThz9yTG3FVQjplF4BPq4Q2xbU4DLpRRDwnUy6dPyMVU9WYOs7Ck56AVAZmjszdthu413Hx-gprdUeJdHqakJOrQ?width=660&height=571&cropmode=none)  
桂馬飛びを利用して、自分で魔方陣を作ってみよう！
1.  大きさが3で割り切れない奇数である方陣を作って、任意のマスに1を置く。
3.  上に2マス右に1マスを繰り返して、次の数を入れていく。
6.  格子の上からはみ出したら格子の下から、格子の右からはみ出したら格子の左から、再入する。
10.  次のマスに既に数が入っていたら、上には進まずに右に2マス進む。
15.  この作業を繰り返して方陣が埋まったら、完成！

出来たかな？ 計算をして答え合わせをしてみよう！ 他にも奇数方陣の作り方は沢山ある。暇な時に自分で調べてやってみるもよし。自分で新たな作り方を考えてみるもよし。とにかく数を楽しもう！！  
では、なぜこの方法で魔方陣が成り立つのかを証明していきたいと思う。 まずはその成り立ちから見ていこう。  
数の世界は不思議だらけだ。そして君はもう生まれた時からこの世界に足を踏み込んでいる。数の無い世界なんて、今日本で生活をしている君には考えられないだろう。もっと深く踏み込めば、きっと毎日わくわくが止まらなくなるだろう。

最後にshundroidさん、色々とご協力ありがとうございました。私はまだまだ未熟であり、今後も日々精進を重ねていきます。これからもお世話になると思いますので、よろしくお願いします。

## 参考文献
* ジョニー・ポール著『目で見る数学』
* [魔方陣 - Wikipedia](https://ja.wikipedia.org/wiki/%E9%AD%94%E6%96%B9%E9%99%A3)
* [魔方陣を紹介します！ 〈73JKI24〉 | Kijidasu](https://kijidasu.com/?p=14545)

------

追記 by Shundroid

### 桂馬跳びによる魔方陣の成り立ち
桂馬飛びの方法で作られた魔方陣は、ある2つの条件を満たす行列の和で表すことが出来る。
そのある条件とは、
* 行列の要素は文字で表され、文字の個数は、行列の行、列の数に等しい
* 行列の各行、列および2つの対角線上に全ての文字が存在する  

である。  
![img5](https://po0poq.bn.files.1drv.com/y4mRxTzUt9pkIL1ukkND4OWYFfFvAt_n9B7yGhU6dqjo60eZT7IceR1ZL6hwAuk_MJP9zzl-c8250Y9cRUyjrFfCp7i7m58oso2-9VuKOL4UWveK4XOZ6qaOrv8r2caSZMJzJU6BiMYJKWHXu2zR4bw0KHXWCSotDVcM0GTzdJKqVt1GnpLEPFc9i2FobWYWCNLWEzW48Rxs3nyCBMlvAYZWQ?width=660&height=194&cropmode=none)  
この条件を満たす行列をここでは<strong>魔方陣行列</strong><sup><a href="#2">\*3</a></sup>と呼ぶ。<u>ほとんどの場合</u>、魔方陣行列はこの「桂馬飛び」で作ることができる。そして、魔方陣行列の和によって生まれる行列の文字に数値を「代入」したものが魔方陣となる。  
「代入」は、最初の魔方陣行列には、$a,\ b,\ c,\ \cdots$に$1,\ 2,\ 3,\ \cdots$を入れていき、後の魔方陣行列には、$A,\ B,\ C,\ \cdots$に$0,\ 5,\ 10,\ \cdots$を入れていくことで行う(これが5の倍数なのは、行列の行数、列数が5だからである)。  
ただし、どの2つの魔方陣行列を足してもいいわけではない。魔方陣の中に同じ数が重複して存在することがある。そのため、「和」にも条件が必要である。それは、
* 足してできた行列に重複する要素が存在しない  

ということである。
<span id="3" style="font-size:x-small">\*3 **魔方陣行列**: 和で作られた行列を魔方陣行列と命名した方がいいかもしれないが、この行列には特に特別な性質は生まれないため、和を構成 する行列の方を名付けた。

### 桂馬飛びの方法と魔方陣行列
先程紹介した桂馬飛びの方法は、上の2つの魔法陣行列を<strong>同時</strong>に作ることができる。 実際にやって確かめてみよう。  
![img6](https://po0qoq.bn.files.1drv.com/y4mpeFQeVAbXzhmkB-4yriu2xKOtSZ2t3lPutIObWXbRNjOzdz4TbHcGvXrwjzo4brKBk26-SfAWeO95W2s3zYjOGoIian-VoIJJCdAQCid7kNAJx50dzP1DJi8nGikACuP-co8dhP_v7ySYFEuUaQ-LglXvVnVvhRbwxaWYtXcVZxocDonoPRpndi20Hw9pHwmLRAmCKqDJC85i_4-yEpPJw?width=660&height=345&cropmode=none)  
ただし、$(a,\ b\, c,\ d,\ e)=(1,\ 2,\ 3,\ 4,\ 5)$、$(A,\ B,\ C,\ D,\ E)=(0,\ 5,\ 10,\ 15,\ 20)$とする。
アは、上に書いた桂馬跳びを用いた奇数方陣の作り方の(3)まで行った状態である。この状態でも最初の魔方陣行列が作れているのは想像できる。  
イは、(4)の作業を行った。そうすると、なんともう1つの桂馬飛びが生まれ、後の魔方陣行列が作られ始めることがわかる。  
ウは完成形である。これは2つの魔方陣行列の和となっている。

#### $9\times9$ではうまくいかない
さて、上に書いた桂馬跳びの方法と、魔方陣行列の和の関係が説明できたところで、$9\times9$の魔方陣が、実はこの方法では出来ない理由を説明する。おそらく、この方法でやっても数字が重複することもなく、行と列の和が乱れることはないだろう。しかし、対角線の和がそろわないのではないだろうか？  
対角線の和が揃わない理由を考えたところ、導かれた結論は「魔方陣を構成する片方の魔方陣行列で、対角線上に同じ文字が存在してしまう(2つ目の条件を満たさない)から」だ。  
この結論を導くうえで、魔方陣のそれぞれのマスを座標で表せるようにしたい。魔方陣を次のような座標平面に見立てる。  
![img7](https://po0joq.bn.files.1drv.com/y4mmgCno2Mx7fz9BQ18kQBQpD6xIV33oIXhjXIR8C2ZzFlDJsYgIFXtObC9l-26OqOneYYck29I_TF2Gav7_q7RnWP1RP8g0m-ETKa3xAe_ZKxBm0I7zIhjePalPaHqBhhDcrEf_E98alSs2lVTVZ7sg0zMJwoE8xAWZXYdRih6uUEgy75C4XtBYkU5N34dgkVzurxA8s-SrHNa5s51eF6jjg?width=400&height=296&cropmode=none)  
そして、最初の魔方陣行列の桂馬飛びの動きを式で表すと、次のようになる。( $a$ は実数)
$$y\equiv2x+a\pmod{9}\ \ \ \ \text{ - (1)}$$
ここで、法を9としているのは、行と列の数が9だからである。  
また、2つ目の魔方陣行列の桂馬飛びの動きは、次のようになる。 ( $b$ は実数)
$$y\equiv-2x+b\pmod{9}\ \ \text{ - (2)}$$
対角線についても同様に式で表す。1つ目は左下から右上に向かうものである。
$$y\equiv x\pmod{9}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \text{ - (3)}$$
2つ目は左上から右下に向かうものである。
$$y\equiv-x+8\pmod{9}\ \ \ \ \text{ - (4)}$$
色々やると分かるが、(1)と(4)、(2)と(3)において重複が発生する。1つ例を挙げると、(1)で$a=2$の時、式で表される桂馬飛びは次のようになり(黄色)、(4)の対角線は次のようになる(青
色)。重複したマスは灰色で示している。  
![img8](https://po0koq.bn.files.1drv.com/y4m0vsQJWn3iWXE9K2n5cYNRWFAQX6onsgk9AHFoSQ-VU7Kkh3dSdgmpL-eoMlNxA8G0YCfmV0lY8sq5W_mzcQ5lRLObeKu_5hYDQSBg9TCsSek6bBcbkywHDHiXP231MxsianuLhLaWdol1308iFO9sR2rn4cz1sEI3uVd_rLXIEeq_soJg6t15QkkxHoRjZNMcWjKZ3cTTP1bXoCcGDkG4A?width=400&height=347&cropmode=none)  
式で示すと、$y$を消去して、
$$2x+x\equiv -x+8$$
したがって、
$$3x\equiv 6$$
これを満たす$x$は、$0\leq x\leq8$の範囲では、$x=2,\ 5,\ 8$。よって、重複が存在することになる。  
一般に、行数・列数が3の倍数の時、桂馬飛びによって対角線がそろわなくなる。これは桂馬飛びの係数の2と、斜めの係数の1が移項されて3となり、3の倍数が法の時に解が複数存在してしまうからである。<br/><br/>
以上より、この方法は大きさが3の倍数の場合に適用できないということが示された。
