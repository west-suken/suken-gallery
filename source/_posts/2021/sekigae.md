---
title: 「全員動く席替え」公式
date: 2021-07-24 17:04:04
tags: 2021年度
---

# 「全員動く席替え」公式

<div style="text-align: right">
    76期 mathist
</div>

※２時間で書いた記事です。~~だってガチで宿題がヤバかったんだもん~~ 厳密さに欠けた部分や、分かりにくい部分等あると思いますが、ご容赦ください。



この記事では、「全員動く席替え」について扱います。

一応すべて数Aの内容にしたつもりです。



## 「全員動く席替え」とは

まず、この記事で具体的に何を扱うのか説明します。

と、ここでいきなり**問題！**



---

---

『1からnまでの自然数を左から大きい順に並べ、それらを並べ替えた。

このとき、全ての自然数の位置が、並べ替える前と変わっているような順列の個数は？』



例えば、
$$
1,2,3,4,5\rightarrow2,3,5,1,4
$$
は条件を満たすが、
$$
1,2,3,4,5\rightarrow2,3,5,4,1
$$
は4が動いていないので条件を満たさない。

---

---



記事ではこの順列を扱います。

見た感じ、高校入試でもこれを使って解く問題が出されそうですね。

さぁ答えは何でしょう？

ぜひ自分でちょっと考えてみてください。





## きっかけ

解く前に、なぜこんな順列を思いついたのかについて触れます。



ある日、筆者のクラスで席替えをしたところ、**41人中2人だけ席が変わりませんでした**。

そこで我らが担任・O崎先生が一言。

**「え、だれかこの確率計算してよ。」**



これにクラスの数強たちが我先に、と飛びつきますが、皆案外苦戦します。



そんなところに、「n人中2人だけ席が変わらない確率」をn=15まで計算する猛者が現れました。
その結果、**人数が多くなるほど、確率は約18.3939%に近づく**ことが判明します。

ということで、「約18.4%」という結論になりました。（意外と高い）



しかし、実は猛者が現れる前に、下のように計算できないかと考えた人もいました。

$$
\frac{_{41}C_2\times(39人を並べ替えたとき、全員位置が変わるような並べ方)}{41!}\qquad\quad(説明は割愛)
$$

しかし、このカッコの中の値を計算するのに時間がかかり、この方法では結局解ききれませんでした。



しかし、性格のひん曲がった超絶暇人の筆者は、上の式を使って**もっと厳密に値を求めたい**、と考えました。





## 解く!

とりあえず、答えから書きます。

### 答え

---

重複のないn個の自然数の並べ替え方は、

$$
_nP_n - _nP _{n-1} + _nP _{n-2}\dots + (-1)^{n-1}{_nP_1}+(-1)^n{_nP_0}
$$

---

もっと簡単に表せるかと思ったんですが、たぶんこれが限界です。

高校入試にも出されそうとか書きましたが、こんなん出されたらトラウマですね。



筆者も導出方法が分からず結局勘で解きました。（2時間くらいかかった...）




## 完全順列（撹乱順列）とモンモール数

...とここから（後付けの）導出方法を解説するつもりだったのですが、ここまで書いて本当に正しいのかにわかに不安になってきた筆者は、万能数学計算サイト・"wolfram alpha"で確認してみました。

すると衝撃の（？ ）事実が明らかに！ 



### by グ〇グル先生

※ここからはグ〇グルの提供でお送りいたします。

前述の式を数列とみなして、

$$
a_n = _nP_n-_nP _{n-1}+_nP _{n-2}\dots+(-1)^{n-1}{_nP_1}+(-1)^n{_nP_0}
$$

を色々いじくると、次の式が得られます。

$$
\begin{array}{}
a_n=na_{n-1}+(-1)^n\\
a_0=1
\end{array}
$$

これをwolfram alphaにぶっこんでみました。

すると...

<img src="https://dm2302files.storage.live.com/y4m2fJ0mgDZ-V8KsXq0-hnHWcRFbcIECZ5fQBRI6YpW5sQT8NYZ9Lh5i93Ax2Qv7lAcnhYEZ1PGh4t3vLuUINkPlUpBUUGBPpqcuDHUHCiELsGCXGkl5kViOTmISvXzyjXzSMJWbSrvERxvArBXF_zrfs2jFFFrpgSYADnAg_E4nzUekHTQAtCz8HPncu70Osdq?width=1620&height=925&cropmode=none"/>

んっ？ なんだこれは？ なんかむっちゃシンプルになってる！ そして撹乱順列とはなんだ！？ 助けてグ〇グル先生！

”撹乱順列”で検索してみたところ...

<img src="https://dm2302files.storage.live.com/y4m2aIxgatYZCA2eEJk7JC1E5iGZLqoKb2ps9oO60Um3qdCaTL4Yiog25213wrLjkAyY9Hyxt94g7hmMi3k_BHgWX1_i2dvZaOOdRkJVr-wbJgCGt1o6_vPGsCfFaBa1khyY1cexcQEGMVjFI9i3yuKOriuJwRsXN1NYVyRN7fwO83mQzKX24oI1NVK93KQmV0Y?width=1620&height=243&cropmode=none"/>

（省略）

<img src="https://dm2302files.storage.live.com/y4mku4-zngzJ7u4wTaUFcy3oKaLvr_OGxyNayrUxKmYj22bN0bSSAhFX_wfGAejZrnWinhF0fBsQQawtNd-bvYXKPj-EO4JshFsmLIYY6PRnNMZhgpmFTDhAjkC0JaEEXlYYvCRM07RU-WESn9uGPiU9Xx23OCIgggGGdDef_YWZ6a2kQyXghjOvgXu6-u4DH2d?width=1620&height=600&cropmode=none"/>

（省略）

<img src="https://dm2302files.storage.live.com/y4mi4mz7tO8tDejBQu5AxMi04yI6AodSmHO_XHy96hMtBKpDoPYK6HqUh87u6XEtnGJHnD2t7bkurfRRAPFafyQNKMa9PrD0GVGFCjkr7KBrO5e-7Gi23RocQwlfUhJk_ijsMI65YHhgSV4i8A0u4sUpAcbovLLzLl2QqLdWOvvESHcYoIUBDky_MjTKoRTYpQ_?width=1620&height=493&cropmode=none" alt="スクリーンショット (9)" style="zoom:50%;" /> 

<div style="text-align :right">
    	ウィキペディア：完全順列 より
</div>

あっ...（察し）

ということで、どうやら「全員動く席替え」を考えた人がすでにいたようです...（よく考えてみればそりゃそうだわ）

さらには、数Ⅲの内容ではありますが、よりシンプルな計算方法があるようです。



というわけで、ここで解き方なんか書いても、"完全順列の個数 公式"とか適当に検索すればずっと分かりやすい記事が見つかることが分かってしまいました...（今筆者は非常に焦ってる。）



せっかくここまで書いたので、ここまでは<u>完全順列の**紹介**</u>ということにして、ここからは少し話を戻して前述した「席替えで2人だけ動かない確率」がなぜ収束するのか考えてみようと思います。



## 41人で席替えしても、1億人で席替えしても、「2人だけ動かない確率」はほとんど変わらない

確認ですが、「席替えでn人中2人だけ席が変わらない確率」は、

$$
\frac{_nC_2\times( _{n-2} P _{n-2} - _{n-2} P _{n-3} + _{n-2} P _{n-4} \dots + (-1)^{n-3}{ _{n-2} P_1}+(-1)^{n-2}{ _{n-2} P_0})}{n!}
$$

と表されることが分かっています。ここで、
$$
_mP_n=\frac{m!}{(m-n)!}\\
_mC_n=\frac{m!}{n!(m-n)!}
$$
であるので、これを用いて上の確率の式を変形すると、
$$
\frac{1}{2}\bigg(\frac{1}{0!}-\frac{1}{1!}+\frac{1}{2!}-\frac{1}{3!}\dots+(-1)^{n-2}\frac{1}{(n-2)!}\bigg)\qquad(ただし、0!=1)\dots(1)
$$
となります。（過程の式はけっこうめんどくさいので省略）

それでは、この式のnにいろんな値を代入してみましょう。（その結果が下の表です。）

| 人数（人） | 席替えで2人だけ動かない確率（％） |
| ---------- | --------------------------------- |
| 10         | 18.394...                         |
| 20         | 18.3939720585721164...            |
| 41         | 18.3939720585721160797761...      |
| ”無限”     | 18.3939720585721160797761...      |

確かに確率は収束するようですね。

人数が41人の場合に至っては、”無限”の場合と、**小数点以下第48桁まで確率が一致**していました。ほぼ一緒です。



実は、階乗の逆数の和
$$
\frac{1}{0!}+\frac{1}{1!}+\frac{1}{2!}+\frac{1}{3!}\dots
$$
の値は収束することが知られています。よって、(1)がこの値より小さいことは明らかであるため、確率は無限にならないことが分かります。



ちなみに、上の表での人数が”無限”の場合の計算は、単純にnに千とか大きい数を代入したわけではなく、小数点以下100桁以上正確に計算できる楽ちんな方法があるので、それを採用しました。説明が難しいので、省略します。（興味があれば、”e^xのマクローリン展開 学びタイムズ”で検索してください。ちょっとだけ微分を使います。）



## 最後に

読んでいただいてありがとうございます！ 

「完全順列」の存在が明らかになったときは、どうしようかととても悩んだので、とりあえず書き切れて良かったです。

数Aで収めようとした無理やり感がありますが、その点は許してください。

「推しを見つけよう」という記事も書いたので、そっちも読んでね。